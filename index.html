<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº‘ç«¯éŸ³ä¹æ’­æ”¾å™¨</title>
    <style>
        :root {
            --ios-bg: #f2f2f7;
            --ios-card: #ffffff;
            --ios-text: #000000;
            --ios-subtext: #8e8e93;
            --ios-blue: #007aff;
            --ios-blur: rgba(255, 255, 255, 0.85);
            --ios-border: #c6c6c8;
            --ios-radius: 12px;
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--ios-bg);
            color: var(--ios-text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* é˜²æ­¢æ•´ä½“æ»šåŠ¨ */
        }

        /* é¡¶éƒ¨å¯¼èˆªä¸æœç´¢ */
        .header {
            background-color: var(--ios-blur);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 10px 15px;
            border-bottom: 0.5px solid var(--ios-border);
            z-index: 100;
        }

        .path-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .back-btn {
            color: var(--ios-blue);
            font-size: 17px;
            background: none;
            border: none;
            padding: 5px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .current-folder {
            font-size: 17px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 60%;
        }

        .search-bar {
            background-color: rgba(118, 118, 128, 0.12);
            border-radius: 10px;
            padding: 8px 10px;
            display: flex;
            align-items: center;
        }

        .search-input {
            border: none;
            background: transparent;
            width: 100%;
            font-size: 17px;
            margin-left: 5px;
            outline: none;
        }

        /* ä¸»åˆ—è¡¨åŒºåŸŸ */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 16px 160px 16px; /* åº•éƒ¨ç•™ç™½ç»™æ’­æ”¾å™¨ */
        }

        .list-group {
            background-color: var(--ios-card);
            border-radius: var(--ios-radius);
            overflow: hidden;
        }

        .list-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background 0.2s;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:active {
            background-color: #e5e5ea;
        }

        .item-icon {
            font-size: 24px;
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }

        .item-info {
            flex: 1;
            overflow: hidden;
        }

        .item-title {
            font-size: 17px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-sub {
            font-size: 13px;
            color: var(--ios-subtext);
            margin-top: 2px;
        }

        .playing-indicator {
            color: var(--ios-blue);
            display: none;
        }
        .list-item.active .playing-indicator { display: block; }
        .list-item.active .item-title { color: var(--ios-blue); font-weight: 600; }

        /* åº•éƒ¨æ’­æ”¾å™¨ */
        .player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--ios-blur);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-top: 0.5px solid var(--ios-border);
            padding: 10px 20px calc(10px + var(--safe-area-bottom)) 20px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
            z-index: 200;
            transition: transform 0.3s ease;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            height: 4px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 2px;
            margin-bottom: 12px;
            position: relative;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--ios-subtext); /* æœªæ¿€æ´»æ—¶ç°è‰² */
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .progress-container:hover .progress-fill, .playing .progress-fill {
            background-color: var(--ios-blue);
        }

        /* æ’­æ”¾æ§åˆ¶åŒº */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .track-info-mini {
            flex: 1;
            margin-right: 15px;
            overflow: hidden;
        }
        
        .track-name-mini {
            font-weight: 600;
            font-size: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-time-mini {
            font-size: 12px;
            color: var(--ios-subtext);
        }

        .control-buttons {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            color: var(--ios-text);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .play-btn svg {
            width: 32px;
            height: 32px;
        }
        
        /* æ’­æ”¾æ—¶æŒ‰é’®é«˜äº® */
        .icon-btn.active {
            color: var(--ios-blue);
        }

        /* æ›´å¤šè®¾ç½®é¢æ¿ (å€é€Ÿã€å®šæ—¶) */
        .settings-panel {
            display: none; /* é»˜è®¤éšè— */
            padding-top: 15px;
            border-top: 0.5px solid rgba(0,0,0,0.05);
            margin-top: 10px;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .settings-panel.show {
            display: grid;
        }

        .setting-item {
            background-color: rgba(0,0,0,0.05);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
        }
        
        .setting-item.active {
            background-color: var(--ios-blue);
            color: white;
        }

        /* ç®€å•çš„ SVG å›¾æ ‡ */
        .svg-icon { width: 24px; height: 24px; }
    </style>
</head>
<body>

    <audio id="audioPlayer" preload="auto"></audio>

    <div class="header">
        <div class="path-nav">
            <button class="back-btn" id="backBtn" onclick="goBack()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                è¿”å›
            </button>
            <div class="current-folder" id="currentFolder">/</div>
            <div style="width: 50px;"></div> <!-- å ä½ç¬¦ä¿æŒå¹³è¡¡ -->
        </div>
        <div class="search-bar">
            <svg width="16" height="16" fill="#8e8e93" viewBox="0 0 24 24"><path d="M21.71 20.29l-5.01-5.01C17.54 13.68 18 11.91 18 10c0-4.41-3.59-8-8-8S2 5.59 2 10s3.59 8 8 8c1.91 0 3.68-.46 5.28-1.3l5.01 5.01c.39.39 1.02.39 1.41 0 .39-.38.39-1.01.01-1.4zM4 10c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z"/></svg>
            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢æ­Œæ›²..." oninput="filterList()">
        </div>
    </div>

    <div class="content">
        <div class="list-group" id="fileList">
            <!-- åˆ—è¡¨é€šè¿‡ JS ç”Ÿæˆ -->
            <div class="list-item" style="justify-content: center; color: gray;">
                æ­£åœ¨è¿æ¥äº‘ç«¯...
            </div>
        </div>
    </div>

    <div class="player-bar" id="playerBar">
        <div class="progress-container" id="progressBar" onclick="seek(event)">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="controls-row">
            <div class="track-info-mini" onclick="toggleSettings()">
                <div class="track-name-mini" id="trackName">æœªæ’­æ”¾</div>
                <div class="track-time-mini" id="trackTime">00:00 / 00:00</div>
            </div>

            <div class="control-buttons">
                <!-- å¾ªç¯æ¨¡å¼ -->
                <button class="icon-btn" id="loopBtn" onclick="toggleLoop()" title="å¾ªç¯æ¨¡å¼">
                    <svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
                </button>
                
                <!-- ä¸Šä¸€é¦– -->
                <button class="icon-btn" onclick="playPrev()">
                    <svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
                </button>

                <!-- æ’­æ”¾/æš‚åœ -->
                <button class="icon-btn play-btn" id="playPauseBtn" onclick="togglePlay()">
                    <svg id="iconPlay" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <svg id="iconPause" viewBox="0 0 24 24" style="display:none"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                </button>

                <!-- ä¸‹ä¸€é¦– -->
                <button class="icon-btn" onclick="playNext()">
                    <svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
                </button>
                
                <!-- è®¾ç½®å±•å¼€ -->
                <button class="icon-btn" onclick="toggleSettings()" id="settingsBtn">
                    <svg viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                </button>
            </div>
        </div>

        <!-- æ‰©å±•è®¾ç½®é¢æ¿ -->
        <div class="settings-panel" id="settingsPanel">
            <!-- å€é€Ÿ -->
            <div class="setting-item" id="speedBtn" onclick="changeSpeed()">å€é€Ÿ: 1.0x</div>
            <!-- å®šæ—¶ -->
            <div class="setting-item" id="timerBtn" onclick="setTimer()">å®šæ—¶å…³é—­</div>
            <!-- åˆ·æ–° -->
            <div class="setting-item" onclick="refreshList()">åˆ·æ–°åˆ—è¡¨</div>
        </div>
    </div>

    <script>
        // --- é…ç½® ---
        const BASE_URL = 'https://res.evanyin.dpdns.org/banyu/'; // é»˜è®¤èµ·å§‹ç›®å½•
        const AUDIO_EXTS = ['.mp3', '.wav', '.flac', '.m4a', '.aac', '.ogg'];

        // --- çŠ¶æ€ ---
        let currentPath = BASE_URL;
        let fileList = []; // å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶/æ–‡ä»¶å¤¹å¯¹è±¡
        let playList = []; // å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰éŸ³é¢‘æ–‡ä»¶ï¼ˆç”¨äºæ’­æ”¾ï¼‰
        let currentTrackIndex = -1;
        let loopMode = 'list'; // 'list' (åˆ—è¡¨å¾ªç¯), 'single' (å•æ›²å¾ªç¯)
        let sleepTimer = null;
        let sleepTimeLeft = 0;
        let playbackRate = 1.0;
        
        const audio = document.getElementById('audioPlayer');
        const ui = {
            list: document.getElementById('fileList'),
            folder: document.getElementById('currentFolder'),
            search: document.getElementById('searchInput'),
            trackName: document.getElementById('trackName'),
            trackTime: document.getElementById('trackTime'),
            playIcon: document.getElementById('iconPlay'),
            pauseIcon: document.getElementById('iconPause'),
            progressFill: document.getElementById('progressFill'),
            loopBtn: document.getElementById('loopBtn'),
            speedBtn: document.getElementById('speedBtn'),
            timerBtn: document.getElementById('timerBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            settingsBtn: document.getElementById('settingsBtn')
        };

        // --- åˆå§‹åŒ– ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchDirectory(currentPath);
            setupAudioEvents();
        });

        // --- æ ¸å¿ƒï¼šæ•°æ®è·å–ä¸è§£æ (DOMParser) ---
        async function fetchDirectory(url) {
            currentPath = url;
            ui.list.innerHTML = '<div class="list-item" style="justify-content:center;color:gray;">åŠ è½½ä¸­...</div>';
            
            // æ›´æ–°å¯¼èˆªæ 
            let displayPath = url.replace('https://res.evanyin.dpdns.org/', '/');
            if(displayPath.length > 20) displayPath = '...' + displayPath.slice(-20);
            ui.folder.textContent = displayPath;

            // æŒ‰é’®çŠ¶æ€
            document.getElementById('backBtn').style.opacity = (url === 'https://res.evanyin.dpdns.org/') ? '0.3' : '1';

            try {
                // ç›´æ¥ fetch HTML
                const response = await fetch(url);
                if(!response.ok) throw new Error("ç½‘ç»œé”™è¯¯");
                const htmlText = await response.text();

                // ä½¿ç”¨ DOMParser è§£æ HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');
                const links = Array.from(doc.querySelectorAll('a'));

                fileList = [];
                playList = [];

                links.forEach(a => {
                    const href = a.getAttribute('href');
                    const text = a.textContent.trim();
                    if(!href || href === '../' || href === './' || text === 'Parent Directory') return;

                    // æ„é€ å®Œæ•´ URL
                    const fullUrl = new URL(href, url).href;
                    const name = decodeURIComponent(text.replace(/\/$/, '')); // å»æ‰æœ«å°¾æ–œæ 
                    const isFolder = text.endsWith('/') || href.endsWith('/');
                    
                    // åˆ¤æ–­æ˜¯å¦éŸ³é¢‘
                    const lowerName = name.toLowerCase();
                    const isAudio = AUDIO_EXTS.some(ext => lowerName.endsWith(ext));

                    if(isFolder || isAudio) {
                        const item = { name, url: fullUrl, isFolder, isAudio };
                        fileList.push(item);
                        if(isAudio) playList.push(item);
                    }
                });

                renderList(fileList);

            } catch (err) {
                console.error(err);
                ui.list.innerHTML = `<div class="list-item" style="color:red;justify-content:center;">åŠ è½½å¤±è´¥: ${err.message}</div>`;
            }
        }

        // --- æ¸²æŸ“åˆ—è¡¨ ---
        function renderList(items) {
            ui.list.innerHTML = '';
            if(items.length === 0) {
                ui.list.innerHTML = '<div class="list-item" style="justify-content:center;color:gray;">ç©ºæ–‡ä»¶å¤¹</div>';
                return;
            }

            // æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰ï¼Œæ–‡ä»¶åœ¨å
            items.sort((a, b) => {
                if (a.isFolder === b.isFolder) return a.name.localeCompare(b.name);
                return a.isFolder ? -1 : 1;
            });

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                // æ ‡è®°æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²
                if(!item.isFolder && currentTrackIndex > -1 && playList[currentTrackIndex] && playList[currentTrackIndex].url === item.url) {
                    div.classList.add('active');
                }

                div.onclick = () => handleClick(item);

                const icon = item.isFolder ? 'ğŸ“' : 'ğŸµ';
                const subInfo = item.isFolder ? 'æ–‡ä»¶å¤¹' : 'éŸ³é¢‘æ–‡ä»¶';

                div.innerHTML = `
                    <div class="item-icon">${icon}</div>
                    <div class="item-info">
                        <div class="item-title">${item.name}</div>
                        <div class="item-sub">${subInfo} <span class="playing-indicator"> (æ’­æ”¾ä¸­)</span></div>
                    </div>
                `;
                ui.list.appendChild(div);
            });
        }

        function filterList() {
            const term = ui.search.value.toLowerCase();
            const filtered = fileList.filter(item => item.name.toLowerCase().includes(term));
            renderList(filtered);
        }

        function handleClick(item) {
            if(item.isFolder) {
                fetchDirectory(item.url);
            } else {
                // æ’­æ”¾éŸ³ä¹
                // æ‰¾åˆ°å®ƒåœ¨ playList ä¸­çš„ç´¢å¼•
                const index = playList.findIndex(p => p.url === item.url);
                if(index !== -1) {
                    playTrack(index);
                }
            }
        }

        function goBack() {
            if(currentPath === 'https://res.evanyin.dpdns.org/') return;
            // å»æ‰æœ«å°¾æ–œæ 
            let temp = currentPath.endsWith('/') ? currentPath.slice(0, -1) : currentPath;
            const parentUrl = temp.substring(0, temp.lastIndexOf('/') + 1);
            fetchDirectory(parentUrl);
        }

        function refreshList() {
            fetchDirectory(currentPath);
            toggleSettings();
        }

        // --- éŸ³é¢‘æ§åˆ¶é€»è¾‘ ---
        function playTrack(index) {
            if(index < 0 || index >= playList.length) return;
            currentTrackIndex = index;
            const track = playList[index];

            audio.src = track.url;
            audio.playbackRate = playbackRate; // ä¿æŒå½“å‰å€é€Ÿ
            audio.play().then(() => {
                updateUIState(true);
            }).catch(e => console.error("æ’­æ”¾å¤±è´¥", e));

            ui.trackName.textContent = track.name;
            
            // æ›´æ–°åˆ—è¡¨é«˜äº®
            renderList(fileList.filter(item => item.name.toLowerCase().includes(ui.search.value.toLowerCase())));
        }

        function togglePlay() {
            if(audio.paused) {
                if(audio.src) audio.play();
                else if(playList.length > 0) playTrack(0);
            } else {
                audio.pause();
            }
        }

        function playNext() {
            if(playList.length === 0) return;
            let nextIndex = currentTrackIndex + 1;
            if(nextIndex >= playList.length) nextIndex = 0; // åˆ—è¡¨å¾ªç¯
            playTrack(nextIndex);
        }

        function playPrev() {
            if(playList.length === 0) return;
            let prevIndex = currentTrackIndex - 1;
            if(prevIndex < 0) prevIndex = playList.length - 1;
            playTrack(prevIndex);
        }

        function updateUIState(isPlaying) {
            ui.playIcon.style.display = isPlaying ? 'none' : 'block';
            ui.pauseIcon.style.display = isPlaying ? 'block' : 'none';
            if(isPlaying) document.getElementById('playerBar').classList.add('playing');
            else document.getElementById('playerBar').classList.remove('playing');
        }

        // è¿›åº¦æ¡æ§åˆ¶
        function seek(e) {
            const rect = ui.progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            if(audio.duration) {
                audio.currentTime = percent * audio.duration;
            }
        }

        function formatTime(seconds) {
            if(isNaN(seconds)) return "00:00";
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // éŸ³é¢‘äº‹ä»¶ç›‘å¬
        function setupAudioEvents() {
            audio.addEventListener('play', () => updateUIState(true));
            audio.addEventListener('pause', () => updateUIState(false));
            
            audio.addEventListener('timeupdate', () => {
                if(audio.duration) {
                    const percent = (audio.currentTime / audio.duration) * 100;
                    ui.progressFill.style.width = `${percent}%`;
                    ui.trackTime.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
                }
            });

            audio.addEventListener('ended', () => {
                if(loopMode === 'single') {
                    audio.currentTime = 0;
                    audio.play();
                } else {
                    playNext();
                }
            });
            
            // é”™è¯¯å¤„ç†ï¼Œè‡ªåŠ¨è·³è¿‡
            audio.addEventListener('error', (e) => {
                console.log("æ’­æ”¾å‡ºé”™ï¼Œå°è¯•ä¸‹ä¸€é¦–");
                setTimeout(() => playNext(), 1000);
            });
        }

        // --- é«˜çº§åŠŸèƒ½ ---

        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettings() {
            ui.settingsPanel.classList.toggle('show');
            ui.settingsBtn.classList.toggle('active');
        }

        // åˆ‡æ¢å¾ªç¯æ¨¡å¼
        function toggleLoop() {
            if(loopMode === 'list') {
                loopMode = 'single';
                ui.loopBtn.style.color = 'var(--ios-blue)';
                ui.loopBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4zm-4-2V9h-1l-2 1v1h1.5v4H13z"/></svg>'; // å¸¦æ•°å­—1çš„å›¾æ ‡
            } else {
                loopMode = 'list';
                ui.loopBtn.style.color = 'var(--ios-text)';
                ui.loopBtn.innerHTML = '<svg viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>';
            }
        }

        // è°ƒæ•´å€é€Ÿ (ç±»ä¼¼ iPhone æ’­å®¢ï¼š1.0 -> 1.25 -> 1.5 -> 2.0 -> 0.5 -> 1.0)
        function changeSpeed() {
            const speeds = [1.0, 1.25, 1.5, 2.0, 0.75];
            let idx = speeds.indexOf(playbackRate);
            idx = (idx + 1) % speeds.length;
            playbackRate = speeds[idx];
            
            // æ ¸å¿ƒï¼šè®¾ç½® HTML5 Audio playbackRate
            // ç°ä»£æµè§ˆå™¨é»˜è®¤ preservesPitch = trueï¼Œæ‰€ä»¥ä¸ä¼šå˜è°ƒ
            audio.playbackRate = playbackRate;
            
            ui.speedBtn.textContent = `å€é€Ÿ: ${playbackRate}x`;
            if(playbackRate !== 1.0) ui.speedBtn.classList.add('active');
            else ui.speedBtn.classList.remove('active');
        }

        // å®šæ—¶å…³æœº
        function setTimer() {
            if(sleepTimer) {
                // å–æ¶ˆå®šæ—¶
                clearTimeout(sleepTimer);
                sleepTimer = null;
                ui.timerBtn.textContent = "å®šæ—¶å…³é—­";
                ui.timerBtn.classList.remove('active');
                alert("å®šæ—¶å·²å–æ¶ˆ");
            } else {
                // è®¾ç½®å®šæ—¶ (æ¼”ç¤ºç®€åŒ–ä¸º30åˆ†é’Ÿï¼Œä½ å¯ä»¥æ”¹æˆå¼¹å‡ºè¾“å…¥æ¡†)
                const minutes = prompt("è¯·è¾“å…¥å¤šå°‘åˆ†é’Ÿååœæ­¢æ’­æ”¾ï¼Ÿ", "30");
                if(minutes && !isNaN(minutes)) {
                    const ms = parseFloat(minutes) * 60 * 1000;
                    ui.timerBtn.classList.add('active');
                    
                    // å€’è®¡æ—¶æ˜¾ç¤ºé€»è¾‘ï¼ˆç®€æ˜“ç‰ˆï¼‰
                    let count = parseFloat(minutes);
                    ui.timerBtn.textContent = `${count}åˆ†ååœæ­¢`;
                    
                    const interval = setInterval(() => {
                        count--;
                        if(count <= 0 || !sleepTimer) clearInterval(interval);
                        else ui.timerBtn.textContent = `${count}åˆ†ååœæ­¢`;
                    }, 60000);

                    sleepTimer = setTimeout(() => {
                        audio.pause();
                        ui.timerBtn.textContent = "å®šæ—¶å…³é—­";
                        ui.timerBtn.classList.remove('active');
                        sleepTimer = null;
                        alert("å®šæ—¶æ—¶é—´åˆ°ï¼Œå·²æš‚åœæ’­æ”¾");
                    }, ms);
                }
            }
        }

    </script>
</body>
</html>
